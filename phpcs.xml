<?xml version="1.0" encoding="UTF-8"?>
<ruleset name="Contact Form 7 to API">
    <description>PHP CodeSniffer configuration for Contact Form 7 to API - SilverAssist Standards</description>

    <!-- Args -->
    <arg name="basepath" value="."/>
    <arg name="cache" value=".phpcs-cache"/>
    <arg name="colors"/>
    <arg name="extensions" value="php"/>
    <arg name="parallel" value="80"/>
    <arg value="p"/>
    <arg value="s"/>

    <!-- Paths to check -->
    <file>includes</file>
    <file>tests</file>
    <file>contact-form-to-api.php</file>

    <!-- Base WordPress-Extra standard -->
    <rule ref="WordPress-Extra">
        <!-- Allow PSR-4 file naming -->
        <exclude name="WordPress.Files.FileName"/>
        <!-- SilverAssist namespace (not plugin prefix) -->
        <exclude name="WordPress.NamingConventions.PrefixAllGlobals.NonPrefixedNamespaceFound"/>
        <!-- Allow short ternaries (modern PHP) -->
        <exclude name="Universal.Operators.DisallowShortTernary"/>
        <!-- Allow non-Yoda conditions (modern PHP) -->
        <exclude name="WordPress.PHP.YodaConditions"/>
        <!-- Allow development functions in test helpers -->
        <exclude name="WordPress.PHP.DevelopmentFunctions"/>
        <!-- Allow eval in test helpers (for dynamic assertions) -->
        <exclude name="Squiz.PHP.Eval"/>
    </rule>

    <!-- Minimum WordPress version -->
    <config name="minimum_wp_version" value="6.5"/>

    <!-- Prefix for global functions/variables -->
    <config name="prefixes" value="cf7_api"/>
    <!-- Prefix for global functions/variables -->
    <config name="prefixes" value="cf7_api"/>

    <!-- Text domain validation -->
    <rule ref="WordPress.WP.I18n">
        <properties>
            <property name="text_domain" type="array">
                <element value="contact-form-to-api"/>
            </property>
        </properties>
    </rule>

    <!-- Allow legacy hook names (public API - breaking change to rename) -->
    <rule ref="WordPress.NamingConventions.PrefixAllGlobals.NonPrefixedHooknameFound">
        <exclude-pattern>includes/ContactForm/Integration.php</exclude-pattern>
    </rule>

    <!-- Allow json_encode in specific contexts where wp_json_encode is not suitable -->
    <rule ref="WordPress.WP.AlternativeFunctions.json_encode_json_encode">
        <exclude-pattern>includes/ContactForm/Integration.php</exclude-pattern>
        <exclude-pattern>tests/*</exclude-pattern>
    </rule>

    <!-- Allow non-strict in_array for backward compatibility -->
    <rule ref="WordPress.PHP.StrictInArray.MissingTrueStrict">
        <exclude-pattern>includes/ContactForm/Integration.php</exclude-pattern>
    </rule>

    <!-- CF7 handles nonce verification in its own submission process -->
    <rule ref="WordPress.Security.NonceVerification.Missing">
        <exclude-pattern>includes/ContactForm/Integration.php</exclude-pattern>
    </rule>

    <!-- Exclude patterns -->
    <exclude-pattern>vendor/*</exclude-pattern>
    <exclude-pattern>node_modules/*</exclude-pattern>
    <exclude-pattern>*.min.*</exclude-pattern>
    <exclude-pattern>languages/*</exclude-pattern>
    <exclude-pattern>.phpcs-cache/*</exclude-pattern>
</ruleset>

